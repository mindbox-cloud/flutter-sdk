name: analyze_and_test

on:
  pull_request:
    branches: [ develop ]

jobs:

  flutter_test:
    name: ${{ matrix.package }} running analyze and tests
    runs-on: ubuntu-latest
    strategy:
      matrix:
        package:
          - 'mindbox'
          - 'mindbox_android'
          - 'mindbox_ios'
          - 'mindbox_platform_interface'
      fail-fast: false
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-java@v1
        with:
          java-version: "12.x"
      - uses: subosito/flutter-action@v1
        with:
          channel: "stable"
      - run: cd ${{ matrix.package }} && flutter pub get
      - run: cd ${{ matrix.package }} && flutter analyze
      - run: cd ${{ matrix.package }} && flutter test
